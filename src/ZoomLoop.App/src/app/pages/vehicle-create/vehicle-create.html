<div class="vehicle-create">
  <div class="vehicle-create__container">
    <h1 class="vehicle-create__title">Create New Vehicle Listing</h1>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="vehicle-form">
      
      <!-- Basic Information -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Basic Information</h2>
        
        <div class="vehicle-form__row">
          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>VIN *</mat-label>
            <input 
              matInput
              type="text" 
              id="vin" 
              formControlName="vin" 
              placeholder="Enter 17-character VIN"
              maxlength="17">
            <mat-error *ngIf="form.get('vin')?.hasError('required')">
              VIN is required
            </mat-error>
            <mat-error *ngIf="form.get('vin')?.hasError('pattern')">
              VIN must be exactly 17 characters
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Stock Number *</mat-label>
            <input matInput type="text" id="stockNumber" formControlName="stockNumber" placeholder="Enter stock number">
            <mat-error *ngIf="form.get('stockNumber')?.hasError('required')">
              Stock number is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="vehicle-form__row">
          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Year *</mat-label>
            <input matInput type="number" id="year" formControlName="year" placeholder="2024">
            <mat-error *ngIf="form.get('year')?.invalid">
              Valid year is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Trim</mat-label>
            <input matInput type="text" id="trim" formControlName="trim" placeholder="LE, Sport, Premium, etc.">
          </mat-form-field>

          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Mileage *</mat-label>
            <input matInput type="number" id="mileage" formControlName="mileage" placeholder="0">
            <mat-error *ngIf="form.get('mileage')?.hasError('required')">
              Mileage is required
            </mat-error>
          </mat-form-field>
        </div>
      </section>

      <!-- Colors -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Colors</h2>
        
        <div class="vehicle-form__row">
          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Exterior Color *</mat-label>
            <input matInput type="text" id="exteriorColor" formControlName="exteriorColor" placeholder="Silver, Black, etc.">
            <mat-error *ngIf="form.get('exteriorColor')?.hasError('required')">
              Exterior color is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Interior Color *</mat-label>
            <input matInput type="text" id="interiorColor" formControlName="interiorColor" placeholder="Black, Beige, etc.">
            <mat-error *ngIf="form.get('interiorColor')?.hasError('required')">
              Interior color is required
            </mat-error>
          </mat-form-field>
        </div>
      </section>

      <!-- Specifications -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Specifications</h2>
        
        <div class="vehicle-form__row">
          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Transmission *</mat-label>
            <mat-select id="transmission" formControlName="transmission">
              <mat-option value="">Select transmission</mat-option>
              <mat-option *ngFor="let trans of transmissions" [value]="trans">{{ trans }}</mat-option>
            </mat-select>
            <mat-error *ngIf="form.get('transmission')?.hasError('required')">
              Transmission is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Fuel Type *</mat-label>
            <mat-select id="fuelType" formControlName="fuelType">
              <mat-option value="">Select fuel type</mat-option>
              <mat-option *ngFor="let fuel of fuelTypes" [value]="fuel">{{ fuel }}</mat-option>
            </mat-select>
            <mat-error *ngIf="form.get('fuelType')?.hasError('required')">
              Fuel type is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Drive Type *</mat-label>
            <mat-select id="driveType" formControlName="driveType">
              <mat-option value="">Select drive type</mat-option>
              <mat-option *ngFor="let drive of driveTypes" [value]="drive">{{ drive }}</mat-option>
            </mat-select>
            <mat-error *ngIf="form.get('driveType')?.hasError('required')">
              Drive type is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="vehicle-form__row">
          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Body Type *</mat-label>
            <mat-select id="bodyType" formControlName="bodyType">
              <mat-option value="">Select body type</mat-option>
              <mat-option *ngFor="let body of bodyTypes" [value]="body">{{ body }}</mat-option>
            </mat-select>
            <mat-error *ngIf="form.get('bodyType')?.hasError('required')">
              Body type is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Doors *</mat-label>
            <input matInput type="number" id="doors" formControlName="doors" min="2" max="6">
            <mat-error *ngIf="form.get('doors')?.invalid">
              Valid door count is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Seats *</mat-label>
            <input matInput type="number" id="seats" formControlName="seats" min="2" max="9">
            <mat-error *ngIf="form.get('seats')?.invalid">
              Valid seat count is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="vehicle-form__row">
          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Engine Size (L)</mat-label>
            <input matInput type="number" id="engineSize" formControlName="engineSize" step="0.1" placeholder="2.5">
          </mat-form-field>

          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Cylinders</mat-label>
            <input matInput type="number" id="cylinders" formControlName="cylinders" placeholder="4">
          </mat-form-field>

          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Horsepower</mat-label>
            <input matInput type="number" id="horsepower" formControlName="horsepower" placeholder="200">
          </mat-form-field>
        </div>

        <div class="vehicle-form__row">
          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>City Fuel (L/100km)</mat-label>
            <input matInput type="number" id="cityFuelConsumption" formControlName="cityFuelConsumption" step="0.1" placeholder="8.5">
          </mat-form-field>

          <mat-form-field appearance="outline" class="vehicle-form__field">
            <mat-label>Highway Fuel (L/100km)</mat-label>
            <input matInput type="number" id="highwayFuelConsumption" formControlName="highwayFuelConsumption" step="0.1" placeholder="6.0">
          </mat-form-field>
        </div>
      </section>

      <!-- Description -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Description</h2>
        
        <mat-form-field appearance="outline" class="vehicle-form__field vehicle-form__field--full">
          <mat-label>Description *</mat-label>
          <textarea 
            matInput
            id="description" 
            formControlName="description" 
            rows="5"
            placeholder="Enter a detailed description of the vehicle..."></textarea>
          <mat-error *ngIf="form.get('description')?.hasError('required')">
            Description is required
          </mat-error>
        </mat-form-field>

        <div class="vehicle-form__checkboxes">
          <mat-checkbox id="isNew" formControlName="isNew">
            New Vehicle
          </mat-checkbox>

          <mat-checkbox id="isCertified" formControlName="isCertified">
            Certified Pre-Owned
          </mat-checkbox>
        </div>
      </section>

      <!-- Images -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Images</h2>
        
        <div 
          class="vehicle-form__dropzone"
          [class.vehicle-form__dropzone--dragging]="isDragging()"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)">
          <input 
            type="file" 
            id="fileInput" 
            multiple 
            accept="image/*"
            (change)="onFileSelect($event)"
            style="display: none;">
          <label for="fileInput" class="vehicle-form__dropzone-label">
            <div class="vehicle-form__dropzone-icon">ðŸ“·</div>
            <p class="vehicle-form__dropzone-text">Drag and drop images here or click to select</p>
            <p class="vehicle-form__dropzone-hint">Supports multiple images</p>
          </label>
        </div>

        <div class="vehicle-form__images" *ngIf="images().length > 0">
          <div 
            *ngFor="let image of images(); let i = index" 
            class="vehicle-form__image"
            [class.vehicle-form__image--primary]="image.isPrimary">
            <img [src]="image.imageUrl" [alt]="'Vehicle image ' + (i + 1)">
            <div class="vehicle-form__image-actions">
              <button 
                type="button" 
                mat-stroked-button
                color="primary"
                (click)="setPrimaryImage(i)"
                *ngIf="!image.isPrimary">
                Set as Primary
              </button>
              <button 
                type="button" 
                mat-stroked-button
                color="warn"
                (click)="removeImage(i)">
                Remove
              </button>
            </div>
            <span class="vehicle-form__image-badge" *ngIf="image.isPrimary">Primary</span>
          </div>
        </div>
      </section>

      <!-- Features -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Features</h2>
        
        <div *ngFor="let category of featureCategories" class="vehicle-form__feature-category">
          <h3 class="vehicle-form__feature-category-title">{{ category.name }}</h3>
          <div class="vehicle-form__feature-list">
            <mat-checkbox
              *ngFor="let feature of category.features" 
              class="vehicle-form__feature"
              [class.vehicle-form__feature--selected]="isFeatureSelected(feature)"
              [attr.id]="'feature-' + category.name + '-' + feature.replace(/\\s+/g, '-')"
              [attr.aria-label]="feature"
              [checked]="isFeatureSelected(feature)"
              (change)="toggleFeature(feature, category.name)">
              {{ feature }}
            </mat-checkbox>
          </div>
        </div>

        <div class="vehicle-form__selected-features" *ngIf="features().length > 0">
          <p><strong>Selected Features ({{ features().length }}):</strong></p>
          <div class="vehicle-form__feature-tags">
            <span 
              *ngFor="let feature of features()" 
              class="vehicle-form__feature-tag"
              (click)="toggleFeature(feature.name, feature.category)">
              {{ feature.name }} Ã—
            </span>
          </div>
        </div>
      </section>

      <!-- Form Actions -->
      <div class="vehicle-form__actions">
        <div class="vehicle-form__error-message" *ngIf="errorMessage()">
          {{ errorMessage() }}
        </div>
        <div class="vehicle-form__button-group">
          <button 
            type="button" 
            mat-stroked-button
            color="primary"
            (click)="cancel()"
            [disabled]="isSubmitting()">
            Cancel
          </button>
          <button 
            type="submit" 
            mat-flat-button
            color="primary"
            [disabled]="form.invalid || isSubmitting()">
            {{ isSubmitting() ? 'Creating...' : 'Create Vehicle' }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
