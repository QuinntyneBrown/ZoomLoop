<div class="vehicle-create">
  <div class="vehicle-create__container">
    <h1 class="vehicle-create__title">Create New Vehicle Listing</h1>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="vehicle-form">
      
      <!-- Basic Information -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Basic Information</h2>
        
        <div class="vehicle-form__row">
          <div class="vehicle-form__field">
            <label for="vin">VIN *</label>
            <input 
              type="text" 
              id="vin" 
              formControlName="vin" 
              placeholder="Enter 17-character VIN"
              maxlength="17">
            <div class="vehicle-form__error" *ngIf="form.get('vin')?.invalid && form.get('vin')?.touched">
              VIN must be exactly 17 characters
            </div>
          </div>

          <div class="vehicle-form__field">
            <label for="stockNumber">Stock Number *</label>
            <input type="text" id="stockNumber" formControlName="stockNumber" placeholder="Enter stock number">
            <div class="vehicle-form__error" *ngIf="form.get('stockNumber')?.invalid && form.get('stockNumber')?.touched">
              Stock number is required
            </div>
          </div>
        </div>

        <div class="vehicle-form__row">
          <div class="vehicle-form__field">
            <label for="year">Year *</label>
            <input type="number" id="year" formControlName="year" placeholder="2024">
            <div class="vehicle-form__error" *ngIf="form.get('year')?.invalid && form.get('year')?.touched">
              Valid year is required
            </div>
          </div>

          <div class="vehicle-form__field">
            <label for="trim">Trim</label>
            <input type="text" id="trim" formControlName="trim" placeholder="LE, Sport, Premium, etc.">
          </div>

          <div class="vehicle-form__field">
            <label for="mileage">Mileage *</label>
            <input type="number" id="mileage" formControlName="mileage" placeholder="0">
            <div class="vehicle-form__error" *ngIf="form.get('mileage')?.invalid && form.get('mileage')?.touched">
              Mileage is required
            </div>
          </div>
        </div>
      </section>

      <!-- Colors -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Colors</h2>
        
        <div class="vehicle-form__row">
          <div class="vehicle-form__field">
            <label for="exteriorColor">Exterior Color *</label>
            <input type="text" id="exteriorColor" formControlName="exteriorColor" placeholder="Silver, Black, etc.">
            <div class="vehicle-form__error" *ngIf="form.get('exteriorColor')?.invalid && form.get('exteriorColor')?.touched">
              Exterior color is required
            </div>
          </div>

          <div class="vehicle-form__field">
            <label for="interiorColor">Interior Color *</label>
            <input type="text" id="interiorColor" formControlName="interiorColor" placeholder="Black, Beige, etc.">
            <div class="vehicle-form__error" *ngIf="form.get('interiorColor')?.invalid && form.get('interiorColor')?.touched">
              Interior color is required
            </div>
          </div>
        </div>
      </section>

      <!-- Specifications -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Specifications</h2>
        
        <div class="vehicle-form__row">
          <div class="vehicle-form__field">
            <label for="transmission">Transmission *</label>
            <select id="transmission" formControlName="transmission">
              <option value="">Select transmission</option>
              <option *ngFor="let trans of transmissions" [value]="trans">{{ trans }}</option>
            </select>
            <div class="vehicle-form__error" *ngIf="form.get('transmission')?.invalid && form.get('transmission')?.touched">
              Transmission is required
            </div>
          </div>

          <div class="vehicle-form__field">
            <label for="fuelType">Fuel Type *</label>
            <select id="fuelType" formControlName="fuelType">
              <option value="">Select fuel type</option>
              <option *ngFor="let fuel of fuelTypes" [value]="fuel">{{ fuel }}</option>
            </select>
            <div class="vehicle-form__error" *ngIf="form.get('fuelType')?.invalid && form.get('fuelType')?.touched">
              Fuel type is required
            </div>
          </div>

          <div class="vehicle-form__field">
            <label for="driveType">Drive Type *</label>
            <select id="driveType" formControlName="driveType">
              <option value="">Select drive type</option>
              <option *ngFor="let drive of driveTypes" [value]="drive">{{ drive }}</option>
            </select>
            <div class="vehicle-form__error" *ngIf="form.get('driveType')?.invalid && form.get('driveType')?.touched">
              Drive type is required
            </div>
          </div>
        </div>

        <div class="vehicle-form__row">
          <div class="vehicle-form__field">
            <label for="bodyType">Body Type *</label>
            <select id="bodyType" formControlName="bodyType">
              <option value="">Select body type</option>
              <option *ngFor="let body of bodyTypes" [value]="body">{{ body }}</option>
            </select>
            <div class="vehicle-form__error" *ngIf="form.get('bodyType')?.invalid && form.get('bodyType')?.touched">
              Body type is required
            </div>
          </div>

          <div class="vehicle-form__field">
            <label for="doors">Doors *</label>
            <input type="number" id="doors" formControlName="doors" min="2" max="6">
            <div class="vehicle-form__error" *ngIf="form.get('doors')?.invalid && form.get('doors')?.touched">
              Valid door count is required
            </div>
          </div>

          <div class="vehicle-form__field">
            <label for="seats">Seats *</label>
            <input type="number" id="seats" formControlName="seats" min="2" max="9">
            <div class="vehicle-form__error" *ngIf="form.get('seats')?.invalid && form.get('seats')?.touched">
              Valid seat count is required
            </div>
          </div>
        </div>

        <div class="vehicle-form__row">
          <div class="vehicle-form__field">
            <label for="engineSize">Engine Size (L)</label>
            <input type="number" id="engineSize" formControlName="engineSize" step="0.1" placeholder="2.5">
          </div>

          <div class="vehicle-form__field">
            <label for="cylinders">Cylinders</label>
            <input type="number" id="cylinders" formControlName="cylinders" placeholder="4">
          </div>

          <div class="vehicle-form__field">
            <label for="horsepower">Horsepower</label>
            <input type="number" id="horsepower" formControlName="horsepower" placeholder="200">
          </div>
        </div>

        <div class="vehicle-form__row">
          <div class="vehicle-form__field">
            <label for="cityFuelConsumption">City Fuel (L/100km)</label>
            <input type="number" id="cityFuelConsumption" formControlName="cityFuelConsumption" step="0.1" placeholder="8.5">
          </div>

          <div class="vehicle-form__field">
            <label for="highwayFuelConsumption">Highway Fuel (L/100km)</label>
            <input type="number" id="highwayFuelConsumption" formControlName="highwayFuelConsumption" step="0.1" placeholder="6.0">
          </div>
        </div>
      </section>

      <!-- Description -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Description</h2>
        
        <div class="vehicle-form__field">
          <label for="description">Description *</label>
          <textarea 
            id="description" 
            formControlName="description" 
            rows="5"
            placeholder="Enter a detailed description of the vehicle..."></textarea>
          <div class="vehicle-form__error" *ngIf="form.get('description')?.invalid && form.get('description')?.touched">
            Description is required
          </div>
        </div>

        <div class="vehicle-form__checkboxes">
          <label class="vehicle-form__checkbox" for="isNew">
            <input type="checkbox" id="isNew" formControlName="isNew">
            <span>New Vehicle</span>
          </label>

          <label class="vehicle-form__checkbox" for="isCertified">
            <input type="checkbox" id="isCertified" formControlName="isCertified">
            <span>Certified Pre-Owned</span>
          </label>
        </div>
      </section>

      <!-- Images -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Images</h2>
        
        <div 
          class="vehicle-form__dropzone"
          [class.vehicle-form__dropzone--dragging]="isDragging()"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)">
          <input 
            type="file" 
            id="fileInput" 
            multiple 
            accept="image/*"
            (change)="onFileSelect($event)"
            style="display: none;">
          <label for="fileInput" class="vehicle-form__dropzone-label">
            <div class="vehicle-form__dropzone-icon">ðŸ“·</div>
            <p class="vehicle-form__dropzone-text">Drag and drop images here or click to select</p>
            <p class="vehicle-form__dropzone-hint">Supports multiple images</p>
          </label>
        </div>

        <div class="vehicle-form__images" *ngIf="images().length > 0">
          <div 
            *ngFor="let image of images(); let i = index" 
            class="vehicle-form__image"
            [class.vehicle-form__image--primary]="image.isPrimary">
            <img [src]="image.imageUrl" [alt]="'Vehicle image ' + (i + 1)">
            <div class="vehicle-form__image-actions">
              <button 
                type="button" 
                class="vehicle-form__image-btn"
                (click)="setPrimaryImage(i)"
                *ngIf="!image.isPrimary">
                Set as Primary
              </button>
              <button 
                type="button" 
                class="vehicle-form__image-btn vehicle-form__image-btn--remove"
                (click)="removeImage(i)">
                Remove
              </button>
            </div>
            <span class="vehicle-form__image-badge" *ngIf="image.isPrimary">Primary</span>
          </div>
        </div>
      </section>

      <!-- Features -->
      <section class="vehicle-form__section">
        <h2 class="vehicle-form__section-title">Features</h2>
        
        <div *ngFor="let category of featureCategories" class="vehicle-form__feature-category">
          <h3 class="vehicle-form__feature-category-title">{{ category.name }}</h3>
          <div class="vehicle-form__feature-list">
            <label 
              *ngFor="let feature of category.features" 
              class="vehicle-form__feature"
              [class.vehicle-form__feature--selected]="isFeatureSelected(feature)"
              [attr.for]="'feature-' + category.name + '-' + feature.replace(/\\s+/g, '-')">
              <input 
                type="checkbox"
                [attr.id]="'feature-' + category.name + '-' + feature.replace(/\\s+/g, '-')"
                [attr.aria-label]="feature"
                [checked]="isFeatureSelected(feature)"
                (change)="toggleFeature(feature, category.name)">
              <span>{{ feature }}</span>
            </label>
          </div>
        </div>

        <div class="vehicle-form__selected-features" *ngIf="features().length > 0">
          <p><strong>Selected Features ({{ features().length }}):</strong></p>
          <div class="vehicle-form__feature-tags">
            <span 
              *ngFor="let feature of features()" 
              class="vehicle-form__feature-tag"
              (click)="toggleFeature(feature.name, feature.category)">
              {{ feature.name }} Ã—
            </span>
          </div>
        </div>
      </section>

      <!-- Form Actions -->
      <div class="vehicle-form__actions">
        <div class="vehicle-form__error-message" *ngIf="errorMessage()">
          {{ errorMessage() }}
        </div>
        <div class="vehicle-form__button-group">
          <button 
            type="button" 
            class="vehicle-form__button vehicle-form__button--secondary"
            (click)="cancel()"
            [disabled]="isSubmitting()">
            Cancel
          </button>
          <button 
            type="submit" 
            class="vehicle-form__button vehicle-form__button--primary"
            [disabled]="form.invalid || isSubmitting()">
            {{ isSubmitting() ? 'Creating...' : 'Create Vehicle' }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
