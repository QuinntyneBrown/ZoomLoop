<div class="loan-calculator-container">
  <div class="header">
    <h1>Vehicle Loan Calculator</h1>
    <p>Calculate your monthly car payment with ease</p>
  </div>

  <form [formGroup]="form" class="calculator-form">
    <div class="form-grid">
      <!-- Vehicle Price -->
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Vehicle Price *</mat-label>
        <input
          matInput
          type="number"
          formControlName="price"
          placeholder="0.00"
          min="0"
          step="100"
        />
        <span matPrefix>$&nbsp;</span>
        <mat-icon
          matSuffix
          matTooltip="The total purchase price of the vehicle before taxes and fees"
          class="info-icon"
          >info</mat-icon
        >
        @if (form.get('price')?.hasError('required') && form.get('price')?.touched) {
          <mat-error>Price is required</mat-error>
        }
        @if (form.get('price')?.hasError('min') && form.get('price')?.touched) {
          <mat-error>Price must be greater than 0</mat-error>
        }
      </mat-form-field>

      <!-- Down Payment -->
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Down Payment</mat-label>
        <input
          matInput
          type="number"
          formControlName="downPayment"
          placeholder="0.00"
          min="0"
          step="100"
        />
        <span matPrefix>$&nbsp;</span>
        <mat-icon
          matSuffix
          matTooltip="Amount paid upfront. Must be between $0 and the vehicle price"
          class="info-icon"
          >info</mat-icon
        >
        @if (form.get('downPayment')?.hasError('min') && form.get('downPayment')?.touched) {
          <mat-error>Down payment cannot be negative</mat-error>
        }
      </mat-form-field>

      <!-- Trade-in Value -->
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Trade-in Value</mat-label>
        <input
          matInput
          type="number"
          formControlName="tradeInValue"
          placeholder="0.00"
          step="100"
        />
        <span matPrefix>$&nbsp;</span>
        <mat-icon
          matSuffix
          matTooltip="Value of your trade-in vehicle. Enter a negative value to represent negative equity (money owed on trade-in)"
          class="info-icon"
          >info</mat-icon
        >
      </mat-form-field>

      <!-- Interest Rate (APR) -->
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Interest Rate (APR) *</mat-label>
        <input
          matInput
          type="number"
          formControlName="interestRate"
          placeholder="7.99"
          min="0"
          max="100"
          step="0.01"
        />
        <span matSuffix>
          %
          <mat-icon
            matTooltip="Annual Percentage Rate (APR) - the yearly interest rate charged on the loan. This is different from the monthly interest rate"
            class="info-icon"
            >info</mat-icon
          >
        </span>
        @if (form.get('interestRate')?.hasError('required') && form.get('interestRate')?.touched) {
          <mat-error>Interest rate is required</mat-error>
        }
        @if (form.get('interestRate')?.hasError('min') && form.get('interestRate')?.touched) {
          <mat-error>Interest rate cannot be negative</mat-error>
        }
        @if (form.get('interestRate')?.hasError('max') && form.get('interestRate')?.touched) {
          <mat-error>Interest rate cannot exceed 100%</mat-error>
        }
      </mat-form-field>

      <!-- Loan Term -->
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Loan Term *</mat-label>
        <mat-select formControlName="termMonths">
          @for (term of termOptions; track term) {
            <mat-option [value]="term">{{ term }} months ({{ term / 12 }} years)</mat-option>
          }
        </mat-select>
        <mat-icon
          matSuffix
          matTooltip="Length of the loan in months"
          class="info-icon"
          >info</mat-icon
        >
        @if (form.get('termMonths')?.hasError('required') && form.get('termMonths')?.touched) {
          <mat-error>Loan term is required</mat-error>
        }
      </mat-form-field>

      <!-- Sales Tax Rate -->
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Sales Tax Rate</mat-label>
        <input
          matInput
          type="number"
          formControlName="taxRate"
          placeholder="7.00"
          min="0"
          max="100"
          step="0.01"
        />
        <span matSuffix>
          %
          <mat-icon
            matTooltip="Sales tax percentage based on your location. This varies by state and local jurisdiction"
            class="info-icon"
            >info</mat-icon
          >
        </span>
        @if (form.get('taxRate')?.hasError('min') && form.get('taxRate')?.touched) {
          <mat-error>Tax rate cannot be negative</mat-error>
        }
        @if (form.get('taxRate')?.hasError('max') && form.get('taxRate')?.touched) {
          <mat-error>Tax rate cannot exceed 100%</mat-error>
        }
      </mat-form-field>

      <!-- Fees -->
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Additional Fees</mat-label>
        <input
          matInput
          type="number"
          formControlName="fees"
          placeholder="0.00"
          min="0"
          step="10"
        />
        <span matPrefix>$&nbsp;</span>
        <mat-icon
          matSuffix
          matTooltip="Registration, documentation, and other dealer fees added to the total cost"
          class="info-icon"
          >info</mat-icon
        >
        @if (form.get('fees')?.hasError('min') && form.get('fees')?.touched) {
          <mat-error>Fees cannot be negative</mat-error>
        }
      </mat-form-field>
    </div>

    <div class="form-actions">
      <button mat-raised-button type="button" (click)="reset()">Reset</button>
      <button mat-raised-button color="primary" type="button" (click)="calculatePayment()">
        Calculate
      </button>
    </div>
  </form>

  <!-- Results Section -->
  @if (monthlyPayment() !== null) {
    <div class="results">
      <h2>Loan Summary</h2>
      <div class="results-grid">
        <div class="result-card">
          <div class="result-label">Monthly Payment</div>
          <div class="result-value">${{ monthlyPayment()! | number: '1.2-2' }}</div>
        </div>
        <div class="result-card">
          <div class="result-label">Total Interest</div>
          <div class="result-value">${{ totalInterest()! | number: '1.2-2' }}</div>
        </div>
        <div class="result-card">
          <div class="result-label">Total Payment</div>
          <div class="result-value">${{ totalPayment()! | number: '1.2-2' }}</div>
        </div>
      </div>
    </div>
  }
</div>
