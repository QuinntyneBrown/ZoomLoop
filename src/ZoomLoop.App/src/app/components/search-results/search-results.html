<div class="search-results-container">
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Searching for vehicles...</p>
    </div>
  } @else {
    <div class="results-header">
      <div class="results-count">
        <h2>{{ filteredResults().length }} Vehicles Found</h2>
        @if (totalResults() !== filteredResults().length) {
          <span class="filter-note">({{ totalResults() }} total matches)</span>
        }
      </div>

      <div class="results-controls">
        <mat-form-field appearance="outline" class="control-field">
          <mat-label>Filter</mat-label>
          <mat-select 
            [value]="localFilterBy()" 
            (selectionChange)="onFilterChange($event.value)">
            @for (option of filterOptions; track option.value) {
              <mat-option [value]="option.value">{{ option.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="control-field">
          <mat-label>Sort By</mat-label>
          <mat-select 
            [value]="localSortBy()" 
            (selectionChange)="onSortChange($event.value)">
            @for (option of sortOptions; track option.value) {
              <mat-option [value]="option.value">{{ option.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    @if (filteredResults().length === 0) {
      <div class="no-results">
        <mat-icon>search_off</mat-icon>
        <h3>No vehicles found</h3>
        <p>Try adjusting your search criteria</p>
      </div>
    } @else {
      <div class="results-grid">
        @for (vehicle of paginatedResults(); track vehicle.vehicleId) {
          <zl-vehicle-card
            [title]="vehicle.year + ' ' + vehicle.make + ' ' + vehicle.model"
            [subtitle]="vehicle.trim"
            [imageUrl]="vehicle.primaryImageUrl || '/assets/default-car.jpg'"
            [price]="vehicle.price ? '$' + vehicle.price.toLocaleString() : 'Contact for Price'"
            [priceLabel]="'Starting at'"
            [badges]="getVehicleBadges(vehicle)"
            [specs]="getVehicleSpecs(vehicle)"
            [certified]="vehicle.isCertified"
            [newArrival]="vehicle.isNew">
          </zl-vehicle-card>
        }
      </div>

      <mat-paginator
        [length]="filteredResults().length"
        [pageSize]="pageSize()"
        [pageIndex]="pageIndex()"
        [pageSizeOptions]="[6, 12, 24, 48]"
        (page)="onPageChange($event)"
        aria-label="Select page">
      </mat-paginator>
    }
  }
</div>
