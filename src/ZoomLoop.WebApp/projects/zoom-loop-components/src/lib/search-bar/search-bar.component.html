<div class="search-bar" [class.search-bar--hero]="variant === 'hero'" [class.search-bar--inline]="variant === 'inline'">
  <div class="search-bar__container" [class.search-bar__container--focused]="isFocused">
    <div class="search-bar__icon">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/>
        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
      </svg>
    </div>

    <input
      type="search"
      class="search-bar__input"
      [placeholder]="placeholder"
      [(ngModel)]="query"
      (ngModelChange)="onQueryChange($event)"
      (focus)="onFocus()"
      (blur)="onBlur()"
      (keydown)="onKeyDown($event)"
      [attr.aria-label]="ariaLabel"
      [attr.aria-expanded]="showSuggestions"
      [attr.aria-controls]="suggestionsId"
      role="combobox"
      aria-autocomplete="list"
    />

    <button
      *ngIf="query"
      class="search-bar__clear"
      (click)="clearSearch()"
      aria-label="Clear search"
      type="button"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>

    <button
      *ngIf="showFiltersButton"
      class="search-bar__filters"
      (click)="filtersClick.emit()"
      type="button"
    >
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="4" y1="21" x2="4" y2="14"/>
        <line x1="4" y1="10" x2="4" y2="3"/>
        <line x1="12" y1="21" x2="12" y2="12"/>
        <line x1="12" y1="8" x2="12" y2="3"/>
        <line x1="20" y1="21" x2="20" y2="16"/>
        <line x1="20" y1="12" x2="20" y2="3"/>
        <line x1="1" y1="14" x2="7" y2="14"/>
        <line x1="9" y1="8" x2="15" y2="8"/>
        <line x1="17" y1="16" x2="23" y2="16"/>
      </svg>
      <span>Filters</span>
    </button>

    <button class="search-bar__submit" (click)="onSearch()" type="button">
      {{ searchButtonText }}
    </button>
  </div>

  <!-- Suggestions Dropdown -->
  <div
    *ngIf="showSuggestions && suggestions.length > 0"
    [id]="suggestionsId"
    class="search-bar__suggestions"
    role="listbox"
  >
    <div *ngFor="let group of groupedSuggestions" class="search-bar__suggestion-group">
      <div class="search-bar__suggestion-label">{{ group.label }}</div>
      <ul class="search-bar__suggestion-list">
        <li
          *ngFor="let suggestion of group.items; let i = index"
          class="search-bar__suggestion-item"
          [class.search-bar__suggestion-item--active]="selectedIndex === getGlobalIndex(group, i)"
          role="option"
          [attr.aria-selected]="selectedIndex === getGlobalIndex(group, i)"
          (click)="selectSuggestion(suggestion)"
          (mouseenter)="selectedIndex = getGlobalIndex(group, i)"
        >
          <span class="search-bar__suggestion-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="3" width="20" height="14" rx="2"/>
              <line x1="2" y1="20" x2="7" y2="20"/>
              <line x1="17" y1="20" x2="22" y2="20"/>
              <circle cx="6" cy="17" r="3"/>
              <circle cx="18" cy="17" r="3"/>
            </svg>
          </span>
          <span class="search-bar__suggestion-text">
            {{ suggestion.label }}
            <span *ngIf="suggestion.sublabel" class="search-bar__suggestion-sublabel">{{ suggestion.sublabel }}</span>
          </span>
          <span *ngIf="suggestion.count" class="search-bar__suggestion-count">{{ suggestion.count }} vehicles</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="search-bar__loading">
    <div class="search-bar__spinner"></div>
    <span>Searching...</span>
  </div>
</div>
