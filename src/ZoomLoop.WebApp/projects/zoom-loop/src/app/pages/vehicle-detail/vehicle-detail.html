@if (vm$ | async; as vm) {
  <div class="vehicle-detail">
    <!-- Breadcrumb -->
    <nav class="vehicle-detail__breadcrumb">
      <a routerLink="/">Home</a>
      <span>/</span>
      <a routerLink="/cars">Cars</a>
      <span>/</span>
      <span>{{ vm.vehicle.year }} {{ vm.vehicle.make }} {{ vm.vehicle.model }}</span>
    </nav>

    <div class="vehicle-detail__content">
      <!-- Left Column -->
      <div class="vehicle-detail__main">
        <div class="vehicle-detail__gallery">
          <zl-image-gallery
            [images]="vm.galleryImages"
            [showThumbnails]="true"
          ></zl-image-gallery>
        </div>

        <div class="vehicle-detail__specs">
          <h3 class="vehicle-detail__specs-title">Vehicle Details</h3>
          <div class="vehicle-detail__specs-grid">
            <div class="vehicle-detail__spec">
              <span class="vehicle-detail__spec-label">Mileage</span>
              <span class="vehicle-detail__spec-value">{{ vm.vehicle.mileage | number }} km</span>
            </div>
            <div class="vehicle-detail__spec">
              <span class="vehicle-detail__spec-label">Exterior</span>
              <span class="vehicle-detail__spec-value">{{ vm.vehicle.exteriorColor }}</span>
            </div>
            <div class="vehicle-detail__spec">
              <span class="vehicle-detail__spec-label">Interior</span>
              <span class="vehicle-detail__spec-value">{{ vm.vehicle.interiorColor }}</span>
            </div>
            <div class="vehicle-detail__spec">
              <span class="vehicle-detail__spec-label">Transmission</span>
              <span class="vehicle-detail__spec-value">{{ vm.vehicle.transmission | titlecase }}</span>
            </div>
            <div class="vehicle-detail__spec">
              <span class="vehicle-detail__spec-label">Drivetrain</span>
              <span class="vehicle-detail__spec-value">{{ vm.vehicle.drivetrain }}</span>
            </div>
            <div class="vehicle-detail__spec">
              <span class="vehicle-detail__spec-label">Fuel Type</span>
              <span class="vehicle-detail__spec-value">{{ vm.vehicle.fuelType | titlecase }}</span>
            </div>
            <div class="vehicle-detail__spec">
              <span class="vehicle-detail__spec-label">Engine</span>
              <span class="vehicle-detail__spec-value">{{ vm.vehicle.engine }}</span>
            </div>
            <div class="vehicle-detail__spec">
              <span class="vehicle-detail__spec-label">Location</span>
              <span class="vehicle-detail__spec-value">{{ vm.vehicle.location }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <aside class="vehicle-detail__sidebar">
        <div class="vehicle-detail__card">
          <h1 class="vehicle-detail__title">{{ vm.vehicle.title }}</h1>

          <div class="vehicle-detail__badges">
            @for (badge of vm.vehicle.badges; track badge) {
              <zl-badge variant="primary" size="sm">{{ badge }}</zl-badge>
            }
            @if (vm.vehicle.isCertified) {
              <zl-badge variant="success" size="sm">Certified</zl-badge>
            }
          </div>

          <div class="vehicle-detail__price">
            <span class="vehicle-detail__price-amount">{{ vm.formattedPrice }}</span>
            @if (vm.formattedMonthlyPayment) {
              <span class="vehicle-detail__price-monthly">
                Est. {{ vm.formattedMonthlyPayment }}/mo
              </span>
            }
          </div>

          <div class="vehicle-detail__actions">
            <zl-button variant="primary" size="lg" [fullWidth]="true" (click)="onPreApproval()">
              Get Pre-Approved
            </zl-button>
            <button class="vehicle-detail__favorite-btn" [class.vehicle-detail__favorite-btn--active]="isFavorite(vm.vehicle.id)" (click)="toggleFavorite(vm.vehicle.id)">
              {{ isFavorite(vm.vehicle.id) ? 'Saved' : 'Save' }}
            </button>
          </div>

          <div class="vehicle-detail__delivery">
            <strong>Free Delivery</strong>
            <span>Delivered to your door</span>
          </div>
        </div>

        <div class="vehicle-detail__calculator">
          <zl-finance-calculator
            title="Estimate Your Payment"
            [vehiclePrice]="vm.vehicle.price"
            (preApprovalClick)="onPreApproval()"
          ></zl-finance-calculator>
        </div>
      </aside>
    </div>

    <section class="vehicle-detail__trust">
      <zl-trust-badges [showDividers]="true"></zl-trust-badges>
    </section>
  </div>
}
